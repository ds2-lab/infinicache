<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Deployment - InfiniCache</title><link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Deployment | InfiniCache</title><meta name="generator" content="Jekyll v4.0.1" /><meta property="og:title" content="Deployment" /><meta property="og:locale" content="en_US" /><meta name="description" content="InfiniCache Project Site" /><meta property="og:description" content="InfiniCache Project Site" /><link rel="canonical" href="http://localhost:4000/docs/deploy/" /><meta property="og:url" content="http://localhost:4000/docs/deploy/" /><meta property="og:site_name" content="InfiniCache" /> <script type="application/ld+json"> {"description":"InfiniCache Project Site","@type":"WebPage","url":"http://localhost:4000/docs/deploy/","headline":"Deployment","@context":"https://schema.org"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"><title>Link</title><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg><div class="page-wrap"><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000" class="site-title lh-tight"> InfiniCache </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button></div><div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list"><li class="navigation-list-item"><a href="http://localhost:4000/" class="navigation-list-link">Home</a><li class="navigation-list-item active"><a href="http://localhost:4000/docs/deploy/" class="navigation-list-link active">Deployment</a></ul></nav></div><footer class="site-footer"><p class="text-small text-grey-dk-000 mb-2">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, made with <a href="https://jekyllrb.com/">Jekyll</a></p></footer></div><div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content"><div class="page-header js-page-header"><div class="search"><div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search InfiniCache" aria-label="Search InfiniCache" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg></div><div class="js-search-results search-results-wrap"></div></div><ul class="list-style-none text-small aux-nav"><li class="d-inline-block my-0"><a href="//github.com/mason-leap-lab/infinicache">InfiniCache on GitHub</a></ul>&nbsp&nbsp<iframe src="https://ghbtns.com/github-btn.html?user=mason-leap-lab&repo=infinicache&type=star&count=true" frameborder="0" scrolling="0" width="90" height="20" title="GitHub"></iframe> <iframe src="https://ghbtns.com/github-btn.html?user=mason-leap-lab&repo=infinicache&type=fork&count=true" frameborder="0" scrolling="0" width="80" height="20" title="GitHub"></iframe></div><div class="page"><div id="main-content" class="page-content" role="main"><h1 id="infinicache-deployment-instruction"> <a href="#infinicache-deployment-instruction" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> InfiniCache Deployment Instruction</h1><h2 id="preparation"> <a href="#preparation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Preparation</h2><ul><li><h3 id="ec2-proxy"> <a href="#ec2-proxy" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> EC2 Proxy</h3><p>Amazon EC2 AMI: ubuntu-xenial-16.04</p><p>Golang version: 1.12</p><p>Be sure the port <strong>6378 - 7380</strong> is avaiable on the proxy</p><p>We recommend that EC2 proxy and Lambda functions are under the same VPC network, and deploy InfiniCache on a EC2 instance with powerful CPU and high bandwidth (<code class="highlighter-rouge">c5n</code> family maybe a good choice).</p><li><h3 id="golang-install"> <a href="#golang-install" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Golang install</h3><p>Jump to <a href="https://github.com/mason-leap-lab/infinicache/blob/master/install_go.md">install_go.md</a></p><li><h3 id="package-install"> <a href="#package-install" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Package install</h3><p>Install basic package</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get <span class="nt">-y</span> upgrade
<span class="nb">sudo </span>apt <span class="nb">install </span>awscli
<span class="nb">sudo </span>apt <span class="nb">install </span>zip
</code></pre></div></div><p>Clone this repo</p><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">go</span> <span class="n">get</span> <span class="o">-</span><span class="n">u</span> <span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">mason</span><span class="o">-</span><span class="n">leap</span><span class="o">-</span><span class="n">lab</span><span class="o">/</span><span class="n">infinicache</span>
</code></pre></div></div><p>Run <code class="highlighter-rouge">aws configure</code> to setup your AWS credential.</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws configure
</code></pre></div></div><li><h3 id="lambda-runtime"> <a href="#lambda-runtime" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Lambda Runtime</h3><ul><li><p>Lambda Role setup</p><p>Go to AWS IAM console and create a role for the lambda cache node (Lambda function).</p><p>AWS IAM console -&gt; Roles -&gt; Create Role -&gt; Lambda -&gt;</p><p><strong><code class="highlighter-rouge">AWSLambdaFullAccess, </code></strong></p><p><strong><code class="highlighter-rouge">AWSLambdaVPCAccessExecutionRole, </code></strong></p><p><strong><code class="highlighter-rouge">AWSLambdaENIManagementAccess</code></strong></p><li><p>Enable Lambda internet access under VPC</p><p>Plese <a href="https://aws.amazon.com/premiumsupport/knowledge-center/internet-access-lambda-function/">refer to this article</a>. (You could skip this step if you do not want to run InfiniCache under VPC).</p><li><p>S3 bucket setup</p><p>Create the S3 bucket to store the zip file of the Lambda code and data output from Lambda functions. Remember the name of this bucket for the configuration in next step.</p></ul><li><h3 id="configuration"> <a href="#configuration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Configuration</h3><ul><li><p>Lambda function create and config</p><p>Edit <code class="highlighter-rouge">deploy/create_function.sh</code> and <code class="highlighter-rouge">deploy/update_function.sh</code></p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">PREFIX</span><span class="o">=</span><span class="s2">"your lambda function prefix"</span>
  <span class="nv">S3</span><span class="o">=</span><span class="s2">"your bucket name"</span>
  <span class="nv">cluster</span><span class="o">=</span>400 <span class="c"># number of lambda in the cache pool</span>
  <span class="nv">mem</span><span class="o">=</span>1536
</code></pre></div></div><p>Edit destination S3 bucket in <code class="highlighter-rouge">lambda/collector/collector.go</code>, this bucket is for the bill duration log from CloudWatch.</p><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">AWSRegion</span> <span class="o">=</span> <span class="s">"us-east-1"</span>
  <span class="n">S3BUCKET</span> <span class="o">=</span> <span class="s">"your bucket name"</span>
</code></pre></div></div><p>Edit <code class="highlighter-rouge">lambda/migrator/client.go</code>, change AWS region if necessary.</p><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">AWSRegion</span> <span class="o">=</span> <span class="s">"us-east-1"</span>
</code></pre></div></div><p>Edit the aws settings and the VPC configuration in <code class="highlighter-rouge">deploy/deploy_function.go</code>. If you do not want to run InfiniCache under VPC, you do not need to modify the <code class="highlighter-rouge">subnet</code> and <code class="highlighter-rouge">securityGroup</code> settings.</p><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">ROLE</span> <span class="o">=</span> <span class="s">"arn:aws:iam::[aws account id]:role/[role name]"</span>
  <span class="n">REGION</span> <span class="o">=</span> <span class="s">"us-east-1"</span>
  <span class="o">...</span>
  <span class="o">...</span>
  <span class="n">subnet</span> <span class="o">=</span> <span class="p">[]</span><span class="o">*</span><span class="kt">string</span><span class="p">{</span>
    <span class="n">aws</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">"your subnet 1"</span><span class="p">),</span>
    <span class="n">aws</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">"your subnet 2"</span><span class="p">),</span>
  <span class="p">}</span>
  <span class="n">securityGroup</span> <span class="o">=</span> <span class="p">[]</span><span class="o">*</span><span class="kt">string</span><span class="p">{</span>
    <span class="n">aws</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">"your security group"</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div></div><p>Run script to create and deploy lambda functions (Also, if you do not want to run InfiniCache under VPC, you need to set the <code class="highlighter-rouge">vpc</code> flag to be <code class="highlighter-rouge">false</code> in <code class="highlighter-rouge">deploy/create_function.sh</code>).</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">export </span><span class="nv">GO111MODULE</span><span class="o">=</span><span class="s2">"on"</span>
  go get
  deploy/create_function.sh 60
</code></pre></div></div><li><p>Proxy configuration</p><p>Edit <code class="highlighter-rouge">proxy/server/config.go</code>, change the aws region, cluster size, and prefix of the Lambda functions.</p><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">const</span> <span class="n">AWSRegion</span> <span class="o">=</span> <span class="s">"us-east-1"</span>
  <span class="k">const</span> <span class="n">NumLambdaClusters</span> <span class="o">=</span> <span class="m">400</span>
  <span class="k">const</span> <span class="n">LambdaPrefix</span> <span class="o">=</span> <span class="s">"Your Lambda Function Prefix"</span>
  <span class="k">const</span> <span class="n">ServerPublicIp</span> <span class="o">=</span> <span class="s">""</span>  <span class="c">// Leave it empty if using VPC.</span>
</code></pre></div></div></ul></ul><h2 id="execution"> <a href="#execution" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Execution</h2><ul><li><p>Proxy server</p><p>Run <code class="highlighter-rouge">make start</code> to start proxy server. <code class="highlighter-rouge">make start</code> would print nothing to the console. If you want to check the log message, you need to set the <code class="highlighter-rouge">debug</code> flag to be <code class="highlighter-rouge">true</code> in the <code class="highlighter-rouge">proxy/proxy.go</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make start
</code></pre></div></div><p>To stop proxy server, run <code class="highlighter-rouge">make stop</code>. If <code class="highlighter-rouge">make stop</code> is not working, you could use <code class="highlighter-rouge">pgrep proxy</code>, <code class="highlighter-rouge">pgrep go</code> to find the pid, and check the <code class="highlighter-rouge">infinicache pid</code> and kill them.</p><li><p>Client library</p><p>The toy demo for Client Library</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go run client/example/main.go
</code></pre></div></div><p>The result should be</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~<span class="nv">$ </span>go run client/example/main.go
2020/03/08 05:05:19 EcRedis Set foo 14630930
2020/03/08 05:05:19 EcRedis Got foo 3551124 <span class="o">(</span> 2677371 865495 <span class="o">)</span>
</code></pre></div></div></ul><h2 id="related-repo"> <a href="#related-repo" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Related repo</h2><p>Client library <a href="https://github.com/mason-leap-lab/infinicache/tree/master/client">ecRedis</a><br /> Redis protocol <a href="https://github.com/mason-leap-lab/redeo">redeo</a><br /> Benchmarking tool <a href="https://github.com/wangaoone/redbench">redbench</a></p></div></div></div></div>
